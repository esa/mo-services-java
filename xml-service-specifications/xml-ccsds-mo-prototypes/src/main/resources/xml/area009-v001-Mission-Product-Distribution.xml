<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright European Space Agency, 2024

  Generated from MPDS Blue Book DraftE 20/03/2024
-->
<mal:specification
    xmlns:mal = "http://www.ccsds.org/schema/ServiceSchema"
    xmlns:svg = "http://www.w3.org/2000/svg"
    xmlns:xsi = "http://www.w3.org/2001/XMLSchema-instance" comment="">
    <mal:area name="MPD" number="9" version="1" comment="Mission Operations services - Mission Product Distribution">

        <mal:service name="ProductRetrieval" number="1" comment="The Product Retrieval Service allows browsing and retrieval of existing products.">
            <mal:documentation name="High-level Requirements" order="1">
                TBD
            </mal:documentation>
            <mal:documentation name="Functional Requirements" order="2">
            </mal:documentation>
            <mal:capabilitySet number="1" comment="">
                <mal:requestIP name="listProducts" number="1" supportInReplay="true" comment="The listProducts operation lists the available products for a selected product filter and optionally also for a selected creation date and for a selected content date time window.">
                    <mal:documentation name="Requirement" order="1">
                        The service provider shall return a list of Product Metadatas that satisfy the specified input filter criteria defined by the product filter, the creation date, and the content creation date.  To pass the filter a product must match all the individual filter criteria.
                        Note: It is implementation dependent whether the Products listed are restricted to those already available or may also be generated on-the-fly in response to the listProducts operation.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						The product filter shall optionally specify the product type and required filters by source and metadata attribute.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						If the creationDate is NULL, then the service provider shall not filter the products based on the creationDate.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="4">
						If the contentDate is NULL, then the service provider shall not filter the products based on the creationDate.
                    </mal:documentation>
                    <mal:messages>
                        <mal:request>
                            <mal:field name="productFilter" canBeNull="false" comment="The product filter used to refine the selection of products.">
                                <mal:type area="MPD" list="false" name="ProductFilter"/>
                            </mal:field>
                            <mal:field name="creationDate" canBeNull="true" comment="The time window used to filter products based on their creation date.">
                                <mal:type area="MPD" list="false" name="TimeWindow"/>
                            </mal:field>
                            <mal:field name="contentDate" canBeNull="true" comment="The time window used to filter products based on their content creation period.">
                                <mal:type area="MPD" list="false" name="TimeWindow"/>
                            </mal:field>
                        </mal:request>
                        <mal:response>
                            <mal:field name="metadatas" canBeNull="false" comment="The list of metadata entries that match the selected filters.">
                                <mal:type area="MPD" list="true" name="ProductMetadata"/>
                            </mal:field>
                        </mal:response>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="A field in the message contains an invalid value. If there are multiple errors, the first invalid field is reported.">
                            <mal:type name="Invalid" area="MPD"/>
                            <mal:extraInformation comment="A UInteger giving a secondary error code that details the reason for invalidity.">
                                <mal:type area="MPD" name="SecondaryErrorCodeEnum" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:requestIP>
                <mal:progressIP name="getProducts" number="2" supportInReplay="true" comment="The getProduct operation retrieves the selected mission data products from the provider.">
                    <mal:documentation name="Requirement" order="1">
						A consumer shall send the list of one or more product references (as ObjectRefs) to the service provider of the products intended to be retrieved.
						Note: The product reference may be known through an out-of-band agreement or may have been determined through the listProducts operation.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						The service provider shall return each referenced product to the service consumer in a separate Update message.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						The final Response message shall be empty, and it indicates to the consumer that all products have been returned.
                    </mal:documentation>
                    <mal:messages>
                        <mal:progress>
                            <mal:field name="productRefs" canBeNull="false" comment="The references to the products to be retrieved.">
                                <mal:type area="MPD" list="true" name="ObjectRef(Product)"/>
                            </mal:field>
                        </mal:progress>
                        <mal:acknowledgement>
                        </mal:acknowledgement>
                        <mal:update>
                            <mal:field name="product" canBeNull="false" comment="The mission data product.">
                                <mal:type area="MPD" list="false" name="Product"/>
                            </mal:field>
                        </mal:update>
                        <mal:response>
                        </mal:response>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="One or more of the productRefs was not found.">
                            <mal:type name="Unknown" area="MPD"/>
                            <mal:extraInformation comment="The indexes of referenced products in the list that were not found. The first item has an index value of 0.">
                                <mal:type area="MAL" name="Integer" list="true"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:progressIP>
                <mal:progressIP name="getProductFiles" number="3" supportInReplay="true" comment="The getProductFiles operation allows consumers to instruct the provider to initiate a remote File Transfer of mission data products to a specified target.">
					<mal:documentation name="Requirement" order="1">
						A consumer shall send a list of one or more product references (as ObjectRefs) to the service provider of the products intended to be transferred.
						Note: The product reference may be known through an out-of-band agreement or may have been determined through the listProducts operation. The message also contains the file delivery address as a URI.
					</mal:documentation>
					<mal:documentation name="Requirement" order="2">
						The provider shall transfer the referenced mission data products to the selected deliverTo URI.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						After each referenced product has been delivered by file transfer, a separate Update message shall be returned containing the product metadata and the respective filename.
					</mal:documentation>
					<mal:documentation name="Requirement" order="4">
						The final Response message shall be empty, and it indicates to the consumer that all products have been delivered.
                    </mal:documentation>
                    <mal:messages>
                        <mal:progress>
                            <mal:field name="productRefs" canBeNull="false" comment="The references to the products to be delivered.">
                                <mal:type area="MPD" list="true" name="ObjectRef(Product)"/>
                            </mal:field>
                            <mal:field name="deliverTo" canBeNull="false" comment="The location's URI where the mission data product must be delivered.">
                                <mal:type area="MAL" list="false" name="URI"/>
                            </mal:field>
                        </mal:progress>
                        <mal:acknowledgement>
                        </mal:acknowledgement>
                        <mal:update>
                            <mal:field name="metadata" canBeNull="false" comment="The metadata of the selected mission data product(s).">
                                <mal:type area="MPD" list="false" name="ProductMetadata"/>
                            </mal:field>
                            <mal:field name="filename" canBeNull="false" comment="The filename of the selected mission data product(s).">
                                <mal:type area="MAL" list="false" name="String"/>
                            </mal:field>
                        </mal:update>
                        <mal:response>
                        </mal:response>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="One or more of the productRefs was not found.">
                            <mal:type name="Unknown" area="MPD"/>
                            <mal:extraInformation comment="The indexes of referenced products in the list that were not found. The first item has an index value of 0.">
                                <mal:type area="MAL" name="Integer" list="true"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                        <mal:errorRef comment="An attempt to deliver a product file to the nominated address failed.">
                            <mal:type name="Delivery Failed" area="MPD"/>
                            <mal:extraInformation comment="ExtraInfo provides additional information on the reason for failure as a free format string.">
                                <mal:type area="MAL" name="String" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:progressIP>
            </mal:capabilitySet>
        </mal:service>
        <mal:service name="OrderManagement" number="2" comment="The Order Management Service is used to submit and manage standing orders. Standing orders specify a product filter to subscribe to a subset of automatically generated products and define the method and destination for product delivery.">
            <mal:documentation name="High-level Requirements" order="1">
                TBD
            </mal:documentation>
            <mal:documentation name="Functional Requirements" order="2">
            </mal:documentation>
            <mal:capabilitySet number="1" comment="">
                <mal:requestIP name="listStandingOrders" number="1" supportInReplay="true" comment="The listStandingOrders operation lists the existing standing orders on the service provider for a given user and domain.">
                    <mal:documentation name="Requirement" order="1">
						The response shall contain a list of standing orders that match the specified user and domain.
						Note: Depending on any mission-specific confidentiality policy, the list of standing orders may be restricted to those belonging to the user associated with the service consumer.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						If the user is NULL, then the service provider shall not filter the standing orders based on the user.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						If the domain is NULL, then the service provider shall not filter the standing orders based on the domain of the products.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="4">
						The domain field shall refer to the domain of the products to which the standing order relates. The standing order itself is not associated with a domain.
                    </mal:documentation>
                    <mal:messages>
                        <mal:request>
                            <mal:field name="user" canBeNull="true" comment="The user of the standing order(s) to be listed.">
                                <mal:type area="MAL" list="false" name="Identifier"/>
                            </mal:field>
                            <mal:field name="domain" canBeNull="true" comment="The domain of the standing order(s) to be listed.">
                                <mal:type area="MAL" list="true" name="Identifier"/>
                            </mal:field>
                        </mal:request>
                        <mal:response>
                            <mal:field name="standingOrders" canBeNull="false" comment="The standing orders that match the selected criteria.">
                                <mal:type area="MPD" list="true" name="StandingOrder"/>
                            </mal:field>
                        </mal:response>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="The referenced user does not exist.">
                            <mal:type name="Unknown" area="MPD"/>
                            <mal:extraInformation comment="ExtraInfo contains the user that does not exist.">
                                <mal:type area="MAL" name="Identifier" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:requestIP>
                <mal:requestIP name="submitStandingOrder" number="2" supportInReplay="true" comment="The submitStandingOrder operation creates a new standing order in the provider for delivery of mission data products.">
                    <mal:documentation name="Requirement" order="1">
						The service provider shall ignore the received value in the orderID field of the orderDetails, and always assign a unique id to the submitted order.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						The service provider shall create a new standing order, then assign a unique ID for the standing order, and return it to the consumer in the Response message.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						Following successful creation of a new standing order, the service provider shall initiate the delivery of requested products following the specified validity window of the standing order.
                   </mal:documentation>
                    <mal:documentation name="Requirement" order="4">
						When the end of the specified validity window is reached, the service provider shall cease delivery of products associated with the standing order.
                   </mal:documentation>
                    <mal:documentation name="Requirement" order="5">
						If the specified delivery method is by file transfer, then the delivery occurs outside the service interface. If the specified delivery method is by service, then the delivery is performed through the operations of the ProductDelivery service.
                    </mal:documentation>
                    <mal:messages>
                        <mal:request>
                            <mal:field name="orderDetails" canBeNull="false" comment="The details of the order to be submitted for processing.">
                                <mal:type area="MPD" list="false" name="StandingOrder"/>
                            </mal:field>
                        </mal:request>
                        <mal:response>
                            <mal:field name="orderID" canBeNull="false" comment="The unique id of the standing order.">
                                <mal:type area="MAL" list="false" name="Long"/>
                            </mal:field>
                        </mal:response>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="A field in the message contains an invalid value. If there are multiple errors, the first invalid field is reported.">
                            <mal:type name="Invalid" area="MPD"/>
                            <mal:extraInformation comment="A UInteger giving a secondary error code that details the reason for invalidity.">
                                <mal:type area="MPD" name="SecondaryErrorCodeEnum" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:requestIP>
                <mal:submitIP name="cancelStandingOrder" number="3" supportInReplay="true" comment="The cancelStandingOrder operation cancels an existing standing order.">
                    <mal:documentation name="Requirement" order="1">
						The service consumer shall send the orderID of the standing order to be cancelled to the service provider.
                    </mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						Note: The authorization aspects of who is allowed to cancel which standing orders is not in the scope of this service specification, as this service specifies only the interface of a product distribution system. In a full system implementation, the authorization is either handled by the implementation of respective rules in the Access Control element of MAL or as part of the service provider software implementation.
                    </mal:documentation>
                    <mal:messages>
                        <mal:submit>
                            <mal:field name="orderID" canBeNull="false" comment="The unique id of the standing order to be cancelled.">
                                <mal:type area="MAL" list="false" name="Long"/>
                            </mal:field>
                        </mal:submit>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="The referenced orderID does not exist.">
                            <mal:type name="Unknown" area="MPD"/>
                            <mal:extraInformation comment="The ExtraInfo contains the orderID that does not exist.">
                                <mal:type area="MAL" name="Long" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:submitIP>
            </mal:capabilitySet>
        </mal:service>
        <mal:service name="ProductOrderDelivery" number="3" comment="The Product Order Delivery Service is used in conjunction with existing standing orders (for the delivery of selected products). File delivery of products, if requested in the standing order, will be delivered without the need to use these service operations. The service provides two capabilities to the consumer: (1) to receive notifications each time their ordered products have been delivered as files; (2) to receive the ordered products via message transfer rather than file delivery.">
            <mal:documentation name="High-level Requirements" order="1">
                TBD
            </mal:documentation>
            <mal:documentation name="Functional Requirements" order="2">
            </mal:documentation>
            <mal:capabilitySet number="1" comment="">
                <mal:pubsubIP name="notifyProductDelivery" number="1" supportInReplay="true" comment="The notifyProductDelivery operation publishes a notification whenever a product has been delivered by file transfer in accordance with an existing standing order.">
                    <mal:documentation name="Requirement" order="1">
						Upon successful file transfer of a mission data product that is associated with a standing order, the service provider shall publish a delivery notification.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						The service provider shall publish the delivery notification together with subscription keys corresponding to the associated user and orderID.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						A service consumer may subscribe to notifications for a specific user, or for all users with the use of the wildcard in the user field.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="4">
						A service consumer may subscribe to notifications for a specific standing order, or for all standing orders with the use of the wildcard in the orderID field.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="5">
						The published message shall contain the metadata, filename, and delivered location of the mission data product that was delivered.
					</mal:documentation>
                    <mal:messages>
                        <mal:subscriptionKeys>
                            <mal:field name="user" canBeNull="false" comment="The user associated with the standing order of the product being notified.">
                                <mal:type area="MAL" list="false" name="Identifier"/>
                            </mal:field>
                            <mal:field name="orderID" canBeNull="false" comment="The orderID associated with the standing order of the product being notified.">
                                <mal:type area="MAL" list="false" name="Long"/>
                            </mal:field>
                        </mal:subscriptionKeys>
                        <mal:publishNotify>
                            <mal:field name="metadata" canBeNull="false" comment="The metadata of the mission data product.">
                                <mal:type area="MPD" list="false" name="ProductMetadata"/>
                            </mal:field>
                            <mal:field name="filename" canBeNull="false" comment="The filename of the mission data product.">
                                <mal:type area="MAL" list="false" name="String"/>
                            </mal:field>
                            <mal:field name="deliveredTo" canBeNull="false" comment="The location's URI where the mission data product was delivered.">
                                <mal:type area="MAL" list="false" name="URI"/>
                            </mal:field>
                        </mal:publishNotify>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="A field in the message contains an invalid value. If there are multiple errors, the first invalid field is reported.">
                            <mal:type name="Invalid" area="MPD"/>
                            <mal:extraInformation comment="A UInteger giving a secondary error code that details the reason for invalidity.">
                                <mal:type area="MPD" name="SecondaryErrorCodeEnum" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                        <mal:errorRef comment="An attempt to deliver a product file to the nominated address failed.">
                            <mal:type name="Delivery Failed" area="MPD"/>
                            <mal:extraInformation comment="ExtraInfo provides additional information on the reason for failure as a free format string.">
                                <mal:type area="MAL" name="String" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:pubsubIP>
                <mal:pubsubIP name="deliverProducts" number="2" supportInReplay="true" comment="The deliverProducts operation publishes mission data products directly via the service interface for an existing standing order.">
                    <mal:documentation name="Requirement" order="1">
						Upon the creation (or availability) of a new mission data product that matches a certain standing order, the service provider shall publish this mission data product via the service interface.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="2">
						The service provider shall publish the mission data product together with subscription keys corresponding to the associated user and orderID.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="3">
						A service consumer may subscribe to mission data products for a specific user, or for all users with the use of the wildcard in the user field.
					</mal:documentation>
                    <mal:documentation name="Requirement" order="4">
						A service consumer may subscribe to mission data products for a specific standing order, or for all standing orders with the use of the wildcard in the orderID field.
					</mal:documentation>
                    <mal:messages>
                        <mal:subscriptionKeys>
                            <mal:field name="user" canBeNull="false" comment="The user associated with the standing order of the product being notified.">
                                <mal:type area="MAL" list="false" name="Identifier"/>
                            </mal:field>
                            <mal:field name="orderID" canBeNull="false" comment="The orderID associated with the standing order of the product being notified.">
                                <mal:type area="MAL" list="false" name="Long"/>
                            </mal:field>
                        </mal:subscriptionKeys>
                        <mal:publishNotify>
                            <mal:field name="product" canBeNull="false" comment="The mission data product.">
                                <mal:type area="MPD" list="false" name="Product"/>
                            </mal:field>
                        </mal:publishNotify>
                    </mal:messages>
                    <mal:errors>
                        <mal:errorRef comment="A field in the message contains an invalid value. If there are multiple errors, the first invalid field is reported.">
                            <mal:type name="Invalid" area="MPD"/>
                            <mal:extraInformation comment="A UInteger giving a secondary error code that details the reason for invalidity.">
                                <mal:type area="MPD" name="SecondaryErrorCodeEnum" list="false"/>
                            </mal:extraInformation>
                        </mal:errorRef>
                    </mal:errors>
                </mal:pubsubIP>
            </mal:capabilitySet>
        </mal:service>

        <mal:dataTypes>
            <mal:composite name="Product" shortFormPart="102" comment="A Product is an MO object that corresponds to a specific occurrence of a generated mission data product.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Object"/>
                </mal:extends>
                <mal:field name="productType" canBeNull="false" comment="The product type definition.">
                    <mal:type area="MPD" list="false" name="ProductType"/>
                </mal:field>
                <mal:field name="creationDate" canBeNull="false" comment="The time at which the product was generated.">
                    <mal:type area="MAL" list="false" name="Time"/>
                </mal:field>
                <mal:field name="source" canBeNull="true" comment="The source that triggered the generation of the product.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="contentDate" canBeNull="false" comment="The period of time to which the source data used to generate the product relates.">
                    <mal:type area="MPD" list="false" name="TimeWindow"/>
                </mal:field>
                <mal:field name="attributes" canBeNull="true" comment="A set of metadata attributes whose name and type correspond to those defined in the productType.">
                    <mal:type area="MAL" list="true" name="NamedValue"/>
                </mal:field>
                <mal:field name="description" canBeNull="true" comment="The textual description of this specific occurrence of the product.">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
                <mal:field name="productBody" canBeNull="false" comment="The product body of the mission data product.">
                    <mal:type area="MAL" list="false" name="Blob"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="ProductType" shortFormPart="101" comment="A ProductType contains the product type definition of a mission data product. The ProductType defines the metadata attributes associated with the product and implies (but does not specify) the structure of the product body. The ProductType is part of the Product Metadata.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="name" canBeNull="false" comment="The name of the Product Type.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="description" canBeNull="true" comment="The description of the Product Type.">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
                <mal:field name="attributeDefs" canBeNull="true" comment="The list of metadata Attribute Definitions.">
                    <mal:type area="MPD" list="true" name="AttributeDef"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="StandingOrder" shortFormPart="201" comment="A StandingOrder is a data structure that holds the details of a standing order. This includes the orderId, the user who owns the product order, the product filter, how the products are to be delivered, the target URI where to deliver the files, and additional comments.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="orderID" canBeNull="true" comment="The orderID of the standing order. It shall be NULL when the order is being submitted.">
                    <mal:type area="MAL" list="false" name="Long"/>
                </mal:field>
                <mal:field name="user" canBeNull="false" comment="The user that is the owner of the product order.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="productFilter" canBeNull="true" comment="Specifies the filter criteria for the standing order, including the product type and optional filters on product source and metadata attributes.">
                    <mal:type area="MPD" list="false" name="ProductFilter"/>
                </mal:field>
                <mal:field name="validityPeriod" canBeNull="true" comment="Period of time over which the standing order is required to be active.">
                    <mal:type area="MPD" list="false" name="TimeWindow"/>
                </mal:field>
                <mal:field name="deliveryMethod" canBeNull="false" comment="Specifies how the product is to be delivered: via the service interface or by file transfer.">
                    <mal:type area="MPD" list="false" name="DeliveryMethodEnum"/>
                </mal:field>
                <mal:field name="deliverTo" canBeNull="true" comment="The delivery address for file transfer. Not required if deliveryMethod is SERVICE.">
                    <mal:type area="MAL" list="false" name="URI"/>
                </mal:field>
                <mal:field name="comments" canBeNull="true" comment="Any optional notes or comments.">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="ProductMetadata" shortFormPart="103" comment="The ProductMetadata comprises the metadata of the product (without the product body) and is used when returning a list of available products for retrieval. A ProductMetadata is associated to a specific Product.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="productType" canBeNull="false" comment="The product type definition.">
                    <mal:type area="MPD" list="false" name="ProductType"/>
                </mal:field>
                <mal:field name="product" canBeNull="false" comment="The reference to the Product.">
                    <mal:type area="MPD" list="false" name="ObjectRef(Product)"/>
                </mal:field>
                <mal:field name="creationDate" canBeNull="false" comment="The time at which the product was generated.">
                    <mal:type area="MAL" list="false" name="Time"/>
                </mal:field>
                <mal:field name="source" canBeNull="true" comment="The source that triggered the generation of the product.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="externalURI" canBeNull="true" comment="An external URI for the products to be retrieved. For example, this can be used for pulling a mission data product file via an http URL link.">
                    <mal:type area="MAL" list="false" name="URI"/>
                </mal:field>
                <mal:field name="contentDate" canBeNull="false" comment="Period of time to which the source data used to generate the product relates.">
                    <mal:type area="MPD" list="false" name="TimeWindow"/>
                </mal:field>
                <mal:field name="attributes" canBeNull="true" comment="Named values for metadata attributes whose name and type correspond to those defined in the referenced ProductType.">
                    <mal:type area="MAL" list="true" name="NamedValue"/>
                </mal:field>
                <mal:field name="description" canBeNull="false" comment="The textual description of this specific occurrence of the product.">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="ProductFilter" shortFormPart="104" comment="The ProductFilter is used in the context of standing orders and service operations requesting a filtered list of available products. It specifies a filter in terms of productType, domain, sources and metadata attribute values. To pass the filter, the product must satisfy all criteria specified: the productType, one of any listed source objects and all specified metadata attribute filters. If no filter is specified for source or attributeFilters then all products of the specified type pass the filter.
A ProductFilter relates to a specific ProductType. Note that the domain filter relates to the domain of the product. The domain of a generic product type (for example an orbit file) may be defined at agency level to avoid the need to define new types for each mission, but the generated product will be associated with a specific mission domain.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="productType" canBeNull="true" comment="The name of the ProductType definition.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="domain" canBeNull="true" comment="The domain to filter on. A wildcard may be used in order to select all possibilities within a sub-domain.">
                    <mal:type area="MAL" list="true" name="Identifier"/>
                </mal:field>
                <mal:field name="sources" canBeNull="true" comment="A set of sources associated products. If the product source matches one of the listed sources, then it passes the filter.">
                    <mal:type area="MAL" list="true" name="Identifier"/>
                </mal:field>
                <mal:field name="attributeFilter" canBeNull="true" comment="Set of attributeFilters defining the desired values of product metadata attributes. If multiple attributeFilters are defined, then the product metadata must match all specified criteria to pass the filter.">
                    <mal:type area="MPD" list="true" name="AttributeFilter"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="TimeWindow" shortFormPart="1" comment="The TimeWindow represents a specific period, between the start and end of a time window.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="start" canBeNull="false" comment="The start time of the time window.">
                    <mal:type area="MAL" list="false" name="Time"/>
                </mal:field>
                <mal:field name="end" canBeNull="false" comment="The end time of the time window.">
                    <mal:type area="MAL" list="false" name="Time"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="AttributeDef" shortFormPart="2" comment="An AttributeDef specifies a metadata attribute in terms of its name, attribute type, optional units, and a free text description.
Note that as AttributeDef is only used in the context of ProductType.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="name" canBeNull="false" comment="The name to the metadata attribute.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="attributeType" canBeNull="false" comment="Specifies the MAL attribute type of the metadata attribute.">
                    <mal:type area="MAL" list="false" name="AttributeType"/>
                </mal:field>
                <mal:field name="units" canBeNull="true" comment="The units associated with the metadata attribute (optional).">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
                <mal:field name="description" canBeNull="true" comment="The description of the metadata attribute (optional).">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="AttributeFilter" comment="An AttributeFilter is an abstract data structure that enables three types of filters: ValueRange, ValueSet, and StringPattern. It is used in the context of selecting a subset of mission data products.">
                <mal:extends>
                    <mal:type area="MAL" list="false" name="Composite"/>
                </mal:extends>
                <mal:field name="name" canBeNull="false" comment="The name of the metadata attribute to filter.">
                    <mal:type area="MAL" list="false" name="Identifier"/>
                </mal:field>
                <mal:field name="include" canBeNull="false" comment="Indicates whether the filter is to include [TRUE] or exclude [FALSE] attribute values that match the filter.">
                    <mal:type area="MAL" list="false" name="Boolean"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="ValueRange" shortFormPart="3" comment="A ValueRange is a concrete subtype of AttributeFilter that allows the specification of an allowed (or disallowed) value range for a metadata attribute.">
                <mal:extends>
                    <mal:type area="MPD" list="false" name="AttributeFilter"/>
                </mal:extends>
                <mal:field name="minimum" canBeNull="true" comment="The minimum value of the value range (greater than or equal to).">
                    <mal:type area="MAL" list="false" name="Attribute"/>
                </mal:field>
                <mal:field name="maximum" canBeNull="true" comment="The maximum value of the value range (less than or equal to).">
                    <mal:type area="MAL" list="false" name="Attribute"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="ValueSet" shortFormPart="4" comment="A ValueSet is a concrete subtype of AttributeFilter that allows the specification of a set of allowed (or disallowed) values for a metadata attribute.">
                <mal:extends>
                    <mal:type area="MPD" list="false" name="AttributeFilter"/>
                </mal:extends>
                <mal:field name="values" canBeNull="false" comment="The set of allowed (or disallowed) values for the metadata attribute.">
                    <mal:type area="MAL" list="true" name="Attribute"/>
                </mal:field>
            </mal:composite>

            <mal:composite name="StringPattern" shortFormPart="5" comment="A StringPattern is a concrete subtype of AttributeFilter that allows the specification of a regular expression (or match pattern) to be searched for in the value of a text type metadata attribute.">
                <mal:extends>
                    <mal:type area="MPD" list="false" name="AttributeFilter"/>
                </mal:extends>
                <mal:field name="regex" canBeNull="false" comment="The regular expression - a sequence of characters that specifies a match pattern to be searched for in a text type metadata attribute (Sting, Identifier or URI).">
                    <mal:type area="MAL" list="false" name="String"/>
                </mal:field>
            </mal:composite>

            <mal:enumeration name="DeliveryMethodEnum" shortFormPart="202" comment="The DeliveryMethodEnum enumeration defines the delivery method to be used for delivery of mission data products.">
                <mal:item nvalue="1" value="SERVICE" comment="The mission data product is to be delivered via service messages. This requires the service consumer to initiate a service operation to subscribe to the products via the existing standing order."/>
                <mal:item nvalue="2" value="FILETRANSFER" comment="The mission data product is to be delivered by file transfer to the address contained in the deliverTo field."/>
            </mal:enumeration>

            <mal:enumeration name="SecondaryErrorCodeEnum" shortFormPart="6" comment="For the Invalid error, the extraInfo field contains a secondary error code defined as a UInteger that allows for deployment specific extensibility. The following standard secondary error codes are defined:">
                <mal:item nvalue="1" value="UNKNOWN" comment="Referenced MO object is not available to the service provider."/>
                <mal:item nvalue="2" value="UNDEFINED" comment="Undefined value for enumeration field."/>
                <mal:item nvalue="3" value="OUT_OF_RANGE" comment="A numeric value is outside the supported range."/>
                <mal:item nvalue="4" value="UNRECOGNIZED" comment="Value of type MAL::Identifier or MAL::String (referencing a named item) does not correspond to a known item."/>
                <mal:item nvalue="5" value="BAD_TIME" comment="A date-time value is outside the supported time period."/>
                <mal:item nvalue="6" value="INCONSISTENT" comment="A value is inconsistent with that of another field within the message. This indicates violation of a constraint rule."/>
            </mal:enumeration>

        </mal:dataTypes>

        <mal:errors>
            <mal:error number="1" name="Invalid" comment="A field in the message contains an invalid value. If there are multiple errors, the first invalid field is reported."/>
            <mal:error number="2" name="Delivery Failed" comment="An attempt to deliver a product file to the nominated address failed."/>
            <mal:error number="3" name="Order Failed" comment="Creation of a new product order failed."/>
            <mal:error number="4" name="Unknown" comment="The referenced item (user or orderID) does not exist."/>
        </mal:errors>

    </mal:area>
</mal:specification>

